<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Customer Parking Dashboard</title>

<style>

/* ===== BASIC LAYOUT ===== */

body{
font-family:'Segoe UI',sans-serif;
margin:0;
background:#f4f6f9;
color:#333;
}

/* HEADER */

.header{
display:flex;
justify-content:space-between;
align-items:center;
padding:20px 40px;
background:#1e3c72;
color:white;
}

.logout-btn{
background:#ff4d4d;
border:none;
padding:8px 15px;
border-radius:6px;
color:white;
cursor:pointer;
}

/* SUMMARY */

.summary-cards{
display:flex;
justify-content:center;
gap:20px;
margin:30px;
flex-wrap:wrap;
}

.summary-card{
background:white;
padding:20px;
width:200px;
text-align:center;
border-radius:10px;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.summary-card h2{
margin:0;
color:#1e3c72;
}

/* VEHICLE CARDS */

.vehicle-cards{
display:flex;
justify-content:center;
gap:20px;
flex-wrap:wrap;
padding:20px;
}

.vehicle-card{
background:white;
width:250px;
padding:20px;
border-radius:10px;
text-align:center;
box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

.vehicle-card img{
width:80px;
margin-bottom:10px;
}

.vehicle-card button{
margin-top:10px;
padding:8px 15px;
border:none;
border-radius:6px;
background:#1e3c72;
color:white;
cursor:pointer;
}

.vehicle-card button:disabled{
background:#999;
}

/* MODAL */

.modal{
display:none;
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.5);
justify-content:center;
align-items:center;
}

.modal-content{
background:white;
padding:25px;
width:320px;
border-radius:10px;
}

.modal-content input{
width:100%;
padding:8px;
margin:8px 0;
}

.modal-content button{
width:100%;
padding:10px;
border:none;
border-radius:6px;
background:#1e3c72;
color:white;
}

.confirm-msg{
margin-top:10px;
color:green;
font-weight:bold;
}

</style>
</head>

<body>

<div class="header">
<h2>Customer Parking Dashboard</h2>
<button class="logout-btn" onclick="logout()">Logout</button>
</div>

<!-- SUMMARY -->
<div class="summary-cards">

<div class="summary-card">
<h2 id="totalSlots">0</h2>
<p>Total Slots</p>
</div>

<div class="summary-card">
<h2 id="availableSlots">0</h2>
<p>Available</p>
</div>

<div class="summary-card">
<h2 id="occupiedSlots">0</h2>
<p>Occupied</p>
</div>

</div>

<!-- VEHICLES -->
<div class="vehicle-cards" id="vehicleCards"></div>

<!-- MODAL -->
<div class="modal" id="bookingModal">
<div class="modal-content">

<h3>Book Parking</h3>

<input id="custName" placeholder="Full Name">
<input id="vehNum" placeholder="Vehicle Number">
<input type="datetime-local" id="entryTime">
<input type="datetime-local" id="exitTime">

<button id="confirmBooking">Confirm Booking</button>

<div class="confirm-msg" id="confirmMsg"></div>

</div>
</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import { getDatabase,ref,get,set,update,push }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";


const firebaseConfig={
apiKey:"AIzaSyAkbz_WM6KT56g1awB-TviU8Uo1svrivJw",
authDomain:"carparkingapp-9267e.firebaseapp.com",
databaseURL:"https://carparkingapp-9267e-default-rtdb.firebaseio.com/",
projectId:"carparkingapp-9267e"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);


// SESSION CHECK

onAuthStateChanged(auth,(user)=>{
if(!user){
window.location.href="customer-login.html";
}
});


let vehicles=[];
const container=document.getElementById('vehicleCards');
const modal=document.getElementById('bookingModal');
const confirmMsg=document.getElementById('confirmMsg');

let currentVehicle=null;


// LOAD PARKING FROM FIREBASE

function loadParkingData(){

get(ref(db,"parking")).then(snapshot=>{

if(snapshot.exists()){

vehicles=Object.entries(snapshot.val()).map(([key,value])=>({
type:key,
...value
}));

renderCards();
updateSummary();

}

});

}

loadParkingData();


// RENDER CARDS

function renderCards(){

container.innerHTML="";

vehicles.forEach((vehicle,index)=>{

const card=document.createElement('div');
card.className='vehicle-card';

card.innerHTML=`
<img src="https://img.icons8.com/ios-filled/100/car.png">
<h3>${vehicle.type}</h3>
<p>Available: ${vehicle.availableSlots}</p>
<p>₹${vehicle.price}/hour</p>
<button ${vehicle.availableSlots===0?'disabled':''}>
${vehicle.availableSlots===0?'Full':'Book'}
</button>
`;

card.querySelector('button').onclick=()=>{
currentVehicle=index;
modal.style.display='flex';
};

container.appendChild(card);

});

}


// BOOKING

document.getElementById('confirmBooking').onclick=()=>{

const name=document.getElementById('custName').value;
const vehNo=document.getElementById('vehNum').value;
const entry=document.getElementById('entryTime').value;
const exit=document.getElementById('exitTime').value;

const user=auth.currentUser;
const vehicle=vehicles[currentVehicle];

if(!name || !vehNo || !entry){
alert("Fill all required fields");
return;
}

const bookingRef=push(ref(db,"bookings"));

set(bookingRef,{
customerName:name,
vehicleType:vehicle.type,
vehicleNumber:vehNo,
entryTime:entry,
exitTime:exit || "",
userId:user.uid,
status:"active",
createdAt:Date.now()
});

update(ref(db,"parking/"+vehicle.type),{
availableSlots:vehicle.availableSlots-1
});

confirmMsg.innerText="✅ Booking Confirmed";

setTimeout(()=>{
modal.style.display='none';
confirmMsg.innerText='';
loadParkingData();
},1500);

};


// SUMMARY

function updateSummary(){

const total=vehicles.reduce((a,v)=>a+v.totalSlots,0);
const available=vehicles.reduce((a,v)=>a+v.availableSlots,0);
const occupied=total-available;

document.getElementById('totalSlots').innerText=total;
document.getElementById('availableSlots').innerText=available;
document.getElementById('occupiedSlots').innerText=occupied;

}


// LOGOUT

window.logout=function(){
signOut(auth).then(()=>{
window.location.href="index.html";
});
};

</script>

</body>
</html>