<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Owner Analytics</title>

<style>

body{
font-family:Arial;
margin:0;
background:#f4f6f9;
}

/* HEADER */

.header{
background:#1f2937;
color:white;
padding:15px 20px;
display:flex;
justify-content:space-between;
align-items:center;
}

/* CONTAINER */

.container{
max-width:1200px;
margin:auto;
padding:20px;
}

/* STATS CARDS */

.stats{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
margin-bottom:30px;
}

.stat-card{
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 5px 15px rgba(0,0,0,0.08);
}

.stat-card h2{
color:#2d8cff;
margin-bottom:5px;
}

/* TABLE */

.table-box{
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 5px 15px rgba(0,0,0,0.08);
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:12px;
border-bottom:1px solid #eee;
text-align:center;
}

th{
background:#1f2937;
color:white;
}

</style>

</head>

<body>

<div class="header">
<h2>ðŸ“Š Owner Analytics Dashboard</h2>
<button onclick="logout()">Logout</button>
</div>

<div class="container">

<div class="stats">

<div class="stat-card">
<h2 id="totalLocations">0</h2>
<p>Total Locations</p>
</div>

<div class="stat-card">
<h2 id="totalBookings">0</h2>
<p>Total Bookings</p>
</div>

<div class="stat-card">
<h2 id="activeBookings">0</h2>
<p>Active Bookings</p>
</div>

<div class="stat-card">
<h2 id="totalEarnings">â‚¹0</h2>
<p>Total Earnings</p>
</div>

</div>

<div class="table-box">

<h3>Booking History</h3>

<table>

<thead>
<tr>
<th>Customer</th>
<th>Vehicle</th>
<th>Type</th>
<th>Entry</th>
<th>Exit</th>
<th>Status</th>
<th>Price</th>
</tr>
</thead>

<tbody id="bookingTable"></tbody>

</table>

</div>

</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signOut }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import { getDatabase, ref, onValue }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";


const firebaseConfig={
apiKey:"AIzaSyAkbz_WM6KT56g1awB-TviU8Uo1svrivJw",
authDomain:"carparkingapp-9267e.firebaseapp.com",
databaseURL:"https://carparkingapp-9267e-default-rtdb.firebaseio.com/",
projectId:"carparkingapp-9267e"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const auth=getAuth(app);


// LOAD LOCATIONS COUNT

onValue(ref(db,"parkingLocations"),snap=>{

if(snap.exists()){
document.getElementById("totalLocations").innerText =
Object.keys(snap.val()).length;
}

});


// LOAD BOOKINGS ANALYTICS

onValue(ref(db,"bookings"),snap=>{

let table=document.getElementById("bookingTable");
table.innerHTML="";

let totalBookings=0;
let activeBookings=0;
let earnings=0;

if(snap.exists()){

Object.values(snap.val()).forEach(b=>{

totalBookings++;

if(b.status==="active"){
activeBookings++;
}

earnings += Number(b.price || 0);

let row=document.createElement("tr");

row.innerHTML=`
<td>${b.customerName}</td>
<td>${b.vehicleNumber}</td>
<td>${b.vehicleType}</td>
<td>${b.entryTime}</td>
<td>${b.exitTime || "-"}</td>
<td>${b.status}</td>
<td>â‚¹${b.price || 0}</td>
`;

table.appendChild(row);

});

}

document.getElementById("totalBookings").innerText=totalBookings;
document.getElementById("activeBookings").innerText=activeBookings;
document.getElementById("totalEarnings").innerText="â‚¹"+earnings;

});


// LOGOUT

window.logout=function(){
signOut(auth).then(()=>{
window.location.href="index.html";
});
};

</script>

</body>
</html>