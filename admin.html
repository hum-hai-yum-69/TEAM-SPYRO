<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard - Parking System</title>
<meta charset="UTF-8">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{min-height:100vh;background:#f4f6f9;padding:30px;}

.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:30px;
}

h1{color:#1e3c72;}

.logout{
background:#ff4d4d;
border:none;
padding:8px 15px;
border-radius:6px;
color:white;
cursor:pointer;
}

.summary{
display:flex;
gap:20px;
margin-bottom:40px;
flex-wrap:wrap;
}

.card{
flex:1;
min-width:200px;
background:white;
padding:25px;
border-radius:12px;
text-align:center;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

.card h2{
font-size:36px;
color:#1e3c72;
}

.table-section{
background:white;
padding:25px;
border-radius:12px;
box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:12px;
text-align:center;
border-bottom:1px solid #ddd;
}

th{
background:#1e3c72;
color:white;
}

tr:hover{
background:#f1f1f1;
}

</style>
</head>

<body>

<div class="header">
<h1>ðŸš— Admin Dashboard</h1>
<button class="logout" onclick="logout()">Logout</button>
</div>

<div class="summary">
<div class="card">
<h2 id="totalSlots">0</h2>
<p>Total Slots</p>
</div>
<div class="card">
<h2 id="availableSlots">0</h2>
<p>Available Slots</p>
</div>
<div class="card">
<h2 id="occupiedSlots">0</h2>
<p>Occupied Slots</p>
</div>
</div>

<div class="table-section">
<h2 style="margin-bottom:15px;text-align:center;">Customer Bookings</h2>

<table>
<thead>
<tr>
<th>Name</th>
<th>Vehicle</th>
<th>Type</th>
<th>Entry</th>
<th>Exit</th>
<th>Status</th>
</tr>
</thead>
<tbody id="bookingTable"></tbody>
</table>

</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

import { getDatabase,ref,onValue }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";


const firebaseConfig={
apiKey:"AIzaSyAkbz_WM6KT56g1awB-TviU8Uo1svrivJw",
authDomain:"carparkingapp-9267e.firebaseapp.com",
databaseURL:"https://carparkingapp-9267e-default-rtdb.firebaseio.com/",
projectId:"carparkingapp-9267e"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);


// SESSION CHECK
onAuthStateChanged(auth,(user)=>{
if(!user){
window.location.href="admin-login.html";
}
});


// LOAD PARKING SUMMARY (REAL-TIME)
onValue(ref(db,"parking"),snapshot=>{

if(snapshot.exists()){

const data=snapshot.val();

let total=0;
let available=0;

Object.values(data).forEach(v=>{
total+=v.totalSlots;
available+=v.availableSlots;
});

document.getElementById("totalSlots").innerText=total;
document.getElementById("availableSlots").innerText=available;
document.getElementById("occupiedSlots").innerText=total-available;

}

});


// LOAD BOOKINGS TABLE (REAL-TIME)
onValue(ref(db,"bookings"),snapshot=>{

const table=document.getElementById("bookingTable");
table.innerHTML="";

if(snapshot.exists()){

Object.values(snapshot.val()).forEach(booking=>{

const row=document.createElement("tr");

row.innerHTML=`
<td>${booking.customerName}</td>
<td>${booking.vehicleNumber}</td>
<td>${booking.vehicleType}</td>
<td>${booking.entryTime}</td>
<td>${booking.exitTime || "-"}</td>
<td>${booking.status}</td>
`;

table.appendChild(row);

});

}

});


// LOGOUT
window.logout=function(){
signOut(auth).then(()=>{
window.location.href="admin-login.html";
});
};

</script>

</body>
</html>